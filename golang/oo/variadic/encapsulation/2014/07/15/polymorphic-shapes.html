<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Polymorphic Shapes</title><meta name=viewport content="width=device-width"><link rel=stylesheet href=./css/main.7112.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js></script><!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><meta name=viewport content="width=device-width, initial-scale=1, user-scalable=no"></head><body><div class=site><header><h1><a class=home-link href="/">Golang Code Examples</a></h1></header><div id=banner><span id=logo></span> <a href=https://github.com/l3x/golang-code-examples class="button fork"><strong>View On GitHub</strong></a><div class=downloads><span>Downloads:</span><ul><li><a href=https://github.com/l3x/golang-code-examples/zipball/master class=button>ZIP</a></li><li><a href=https://github.com/l3x/golang-code-examples/tarball/master class=button>TAR</a></li></ul></div></div><!-- end banner --><div class=wrapper><nav><ul></ul></nav><div class=page-title><h2>Polymorphic Shapes</h2><p class=meta>15 Jul 2014</p></div><div class=post><p><section></section></p><h2>Description</h2><p>This example demonstrates how to leverage structs and methods to derive polymorphic benefits when creating rectangle and circle shapes.</p><p>We use the variadic idiom to pass any number of shape object parameters to calculate their total area.</p><p>We also demonstrate passing by value and how to use pointers to pass by reference.</p><hr><h2>Golang Features</h2><p>This golang code sample demonstrates the following go language features:</p><ul><li>string and float64 data types</li><li>constants</li><li>variables with initializers</li><li>iterating ranges</li><li>slices</li><li>encapsulation / visibility</li><li>variadic functions</li><li>new function</li><li>pointers</li><li>structs / struct literals</li><li>methods</li><li>multiple implicit interfaces</li><li>signature based polymorphism</li></ul><h2>Code Example</h2><div class=highlight><pre><code class="go language-go" data-lang=go><span class=kn>package</span> <span class=nx>main</span>    <span class=c1>// Executable commands must always use package main.</span>

<span class=kn>import</span> <span class=p>(</span>
    <span class=s>&quot;fmt&quot;</span>       <span class=c1>// fmt.Println formats output to console</span>
    <span class=s>&quot;math&quot;</span>      <span class=c1>// provides math.Sqrt function</span>
<span class=p>)</span>

<span class=c1>// ----------------------</span>
<span class=c1>//    Shape interface</span>
<span class=c1>// ----------------------</span>
<span class=c1>// Shape interface defines a method set (consisting of the area method)</span>
<span class=kd>type</span> <span class=nx>Shape</span> <span class=kd>interface</span> <span class=p>{</span>
    <span class=nx>area</span><span class=p>()</span> <span class=kt>float64</span>          <span class=c1>// any type that implements an area method is considered a Shape</span>
<span class=p>}</span>
<span class=c1>// Calculate total area of all shapes via polymorphism (all shapes implement the area method)</span>
<span class=kd>func</span> <span class=nx>totalArea</span><span class=p>(</span><span class=nx>shapes</span> <span class=o>...</span><span class=nx>Shape</span><span class=p>)</span> <span class=kt>float64</span> <span class=p>{</span>   <span class=c1>// Use interface type as as function argument</span>
    <span class=kd>var</span> <span class=nx>area</span> <span class=kt>float64</span>                        <span class=c1>// &quot;...&quot; makes shapes &quot;variadic&quot; (can send one or more)</span>
    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>s</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>shapes</span> <span class=p>{</span>
        <span class=nx>area</span> <span class=o>+=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>area</span><span class=p>()</span>    <span class=c1>// the current Shape implements/receives the area method</span>
    <span class=p>}</span>                       <span class=c1>// go passes the pointer to the shape to the area method</span>
    <span class=k>return</span> <span class=nx>area</span>
<span class=p>}</span>

<span class=c1>// ----------------------</span>
<span class=c1>//    Drawer interface</span>
<span class=c1>// ----------------------</span>
<span class=kd>type</span> <span class=nx>Drawer</span> <span class=kd>interface</span> <span class=p>{</span>
    <span class=nx>draw</span><span class=p>()</span>                  <span class=c1>// does not return a type</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=nx>drawShape</span><span class=p>(</span><span class=nx>d</span> <span class=nx>Drawer</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// associate this method with the Drawer interface</span>
    <span class=nx>d</span><span class=p>.</span><span class=nx>draw</span><span class=p>()</span>
<span class=p>}</span>

<span class=c1>// ----------------------</span>
<span class=c1>//      Circle Type</span>
<span class=c1>// ----------------------</span>
<span class=kd>type</span> <span class=nx>Circle</span> <span class=kd>struct</span> <span class=p>{</span>        <span class=c1>// Since &quot;Circle&quot; is capitalized, it is visible outside this package</span>
    <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>r</span> <span class=kt>float64</span>         <span class=c1>// a Circle struct is a collection of fields: x, y, r</span>
<span class=p>}</span>
<span class=c1>// Circle implements Shape interface b/c it has an area method</span>
<span class=c1>// area is a method, which is special type of function that is associated with the Circle struct</span>
<span class=c1>// The Circle struct becomes the &quot;receiver&quot; of this method, so we can use the &quot;.&quot; operator</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Circle</span><span class=p>)</span> <span class=nx>area</span><span class=p>()</span> <span class=kt>float64</span> <span class=p>{</span>   <span class=c1>// dereference Circle type (data pointed to by c)</span>
    <span class=k>return</span> <span class=nx>math</span><span class=p>.</span><span class=nx>Pi</span> <span class=o>*</span> <span class=nx>c</span><span class=p>.</span><span class=nx>r</span> <span class=o>*</span> <span class=nx>c</span><span class=p>.</span><span class=nx>r</span>      <span class=c1>// Pi is a constant in the math package</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=nx>Circle</span><span class=p>)</span> <span class=nx>draw</span><span class=p>()</span> <span class=p>{</span>                                
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Circle drawing with radius: &quot;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>r</span><span class=p>)</span>    <span class=c1>// encapsulated draw implementation for Circle type</span>
<span class=p>}</span>
<span class=c1>// ----------------------</span>
<span class=c1>//     Rectangle Type</span>
<span class=c1>// ----------------------</span>
<span class=kd>type</span> <span class=nx>Rectangle</span> <span class=kd>struct</span> <span class=p>{</span>     <span class=c1>// a struct contains named fields of data</span>
    <span class=nx>x1</span><span class=p>,</span> <span class=nx>y1</span><span class=p>,</span> <span class=nx>x2</span><span class=p>,</span> <span class=nx>y2</span> <span class=kt>float64</span>  <span class=c1>// define multiple fields with same data type on one line</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=nx>distance</span><span class=p>(</span><span class=nx>x1</span><span class=p>,</span> <span class=nx>y1</span><span class=p>,</span> <span class=nx>x2</span><span class=p>,</span> <span class=nx>y2</span> <span class=kt>float64</span><span class=p>)</span> <span class=kt>float64</span> <span class=p>{</span>         <span class=c1>// lowercase functin name visible only in this package</span>
    <span class=nx>a</span> <span class=o>:=</span> <span class=nx>x2</span> <span class=o>-</span> <span class=nx>x1</span>
    <span class=nx>b</span> <span class=o>:=</span> <span class=nx>y2</span> <span class=o>-</span> <span class=nx>y1</span>
    <span class=k>return</span> <span class=nx>math</span><span class=p>.</span><span class=nx>Sqrt</span><span class=p>(</span><span class=nx>a</span> <span class=o>*</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span> <span class=o>*</span> <span class=nx>b</span><span class=p>)</span>
<span class=p>}</span>
<span class=c1>// Rectangle implements Shape interface b/c it has an area method</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>Rectangle</span><span class=p>)</span> <span class=nx>area</span><span class=p>()</span> <span class=kt>float64</span> <span class=p>{</span>       <span class=c1>// &quot;r&quot; is passed by reference</span>
    <span class=nx>l</span> <span class=o>:=</span> <span class=nx>distance</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>x1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>y1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>x1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>y2</span><span class=p>)</span>  <span class=c1>// define and assign local variable &quot;l&quot;</span>
    <span class=nx>w</span> <span class=o>:=</span> <span class=nx>distance</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>x1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>y1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>x2</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>y1</span><span class=p>)</span>  <span class=c1>// l and w only available within scope of area function</span>
    <span class=k>return</span> <span class=nx>l</span> <span class=o>*</span> <span class=nx>w</span>
<span class=p>}</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>Rectangle</span><span class=p>)</span> <span class=nx>draw</span><span class=p>()</span> <span class=p>{</span>                <span class=c1>// &quot;r&quot; is passed by value</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;Rectangle drawing with point1: (%f, %f) and point2: (%f, %f)\n&quot;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>x1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>y1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>x2</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>y2</span><span class=p>)</span>
<span class=p>}</span>
<span class=c1>// ----------------------</span>
<span class=c1>//    MultiShape Type</span>
<span class=c1>// ----------------------</span>
<span class=kd>type</span> <span class=nx>MultiShape</span> <span class=kd>struct</span> <span class=p>{</span>
    <span class=nx>shapes</span> <span class=p>[]</span><span class=nx>Shape</span>  <span class=c1>// shapes field is a slice of interfaces</span>
<span class=p>}</span>
<span class=c1>//</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MultiShape</span><span class=p>)</span> <span class=nx>area</span><span class=p>()</span> <span class=kt>float64</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>area</span> <span class=kt>float64</span>
    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>shape</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>m</span><span class=p>.</span><span class=nx>shapes</span> <span class=p>{</span>    <span class=c1>// iterate through shapes (&quot;_&quot; indicates that index is not used)</span>
        <span class=nx>area</span> <span class=o>+=</span> <span class=nx>shape</span><span class=p>.</span><span class=nx>area</span><span class=p>()</span>            <span class=c1>// execute polymorphic area method for this shape</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nx>area</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>c</span> <span class=o>:=</span> <span class=nx>Circle</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span>                                            <span class=c1>// initialize new instance of Circle type by field order &quot;struct literal&quot;</span>
                                                                    <span class=c1>// The new function allocates memory for all  fields, sets each to their zero value and returns a pointer</span>
    <span class=nx>c2</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Circle</span><span class=p>)</span>                                               <span class=c1>// c2 is a pointer to the instantiated Circle type</span>
    <span class=nx>c2</span><span class=p>.</span><span class=nx>x</span> <span class=p>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>c2</span><span class=p>.</span><span class=nx>y</span> <span class=p>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>c2</span><span class=p>.</span><span class=nx>r</span> <span class=p>=</span> <span class=mi>10</span>                                   <span class=c1>// initialize data with multiple statements on one line</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Circle Area:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>c</span><span class=p>))</span>                      <span class=c1>// pass address of circle (c)</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Circle2 Area:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=nx>c2</span><span class=p>))</span>                     <span class=c1>// c2 was defined using built-in new function</span>
    <span class=nx>r</span> <span class=o>:=</span> <span class=nx>Rectangle</span><span class=p>{</span><span class=nx>x1</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>y1</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>x2</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nx>y2</span><span class=p>:</span> <span class=mi>5</span><span class=p>}</span>                      <span class=c1>// &quot;struct literal&quot; rectangle (r) initialized by field name</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Rectangle Area:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>r</span><span class=p>))</span>                   <span class=c1>// pass address of rectangle (r)</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Rectangle + Circle Area:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>c</span><span class=p>,</span> <span class=nx>c2</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>r</span><span class=p>))</span>  <span class=c1>// can pass multiple shapes</span>
    <span class=nx>m</span> <span class=o>:=</span> <span class=nx>MultiShape</span><span class=p>{[]</span><span class=nx>Shape</span><span class=p>{</span><span class=o>&amp;</span><span class=nx>r</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>c</span><span class=p>,</span> <span class=nx>c2</span><span class=p>}}</span>                            <span class=c1>// pass slice of shapes</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Multishape Area:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>m</span><span class=p>))</span>                  <span class=c1>// calculate total area of all shapes</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;Area Totals:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>c</span><span class=p>,</span> <span class=nx>c2</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>r</span><span class=p>))</span>              <span class=c1>// c2 is a pointer to a circle, &amp;c and &amp;r are addresses of shapes</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nx>Println</span><span class=p>(</span><span class=s>&quot;2 X Area Totals:&quot;</span><span class=p>,</span> <span class=nx>totalArea</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>c</span><span class=p>,</span> <span class=nx>c2</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>r</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>m</span><span class=p>))</span>      <span class=c1>// twice the size of all areas</span>
    <span class=nx>drawShape</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>                                                    <span class=c1>// execute polymorphic method call</span>
    <span class=nx>drawShape</span><span class=p>(</span><span class=nx>c2</span><span class=p>)</span>
    <span class=nx>drawShape</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h2>Output</h2><div class=highlight><pre><code class="text language-text" data-lang=text>Circle Area: 78.53981633974483
Circle2 Area: 314.1592653589793
Rectangle Area: 25
Rectangle + Circle Area: 417.69908169872417
Multishape Area: 417.69908169872417
Area Totals: 417.69908169872417
2 X Area Totals: 835.3981633974483
Circle drawing with radius:  5
Circle drawing with radius:  10
Rectangle drawing with point1: (0.000000, 0.000000) and point2: (5.000000, 5.000000)

Process finished with exit code 0
</code></pre></div><h2>References</h2><ul><li><a href="http://www.golang-book.com/">Golang Book</a></li><li><a href=http://golang.org/doc/code.html>How to Write Go Code</a></li><li><a href="http://tour.golang.org/">Golang Tour</a></li></ul><p></p></div></div><div class=footer><div class=contact><p><div id=name-gravatar class=float-left><span>By Lex Sheehan</span> <span id=l3x-gravatar></span></div><div class=float-right><strong>It's Go Time!</strong></div></p></div></div></div><script src=./js/scripts.65a4.js></script></body></html>